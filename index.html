<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UFO ìš´ì„ í”¼í•˜ê¸°</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #000428, #004e92);
            font-family: 'Press Start 2P', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        #gameContainer {
            position: relative;
            border: 4px solid #ffffff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        
        canvas {
            display: block;
            background: linear-gradient(to bottom, #001122, #003366);
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        #ui {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 12px;
            text-shadow: 2px 2px 0px #000000;
        }
        
        #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        
        .title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #00ff00;
            text-shadow: 2px 2px 0px #000000;
        }
        
        .instruction {
            font-size: 10px;
            margin: 5px 0;
            text-shadow: 1px 1px 0px #000000;
        }
        
        .gameOverTitle {
            font-size: 24px;
            color: #ff0000;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px #000000;
        }
        
        .score {
            font-size: 14px;
            margin: 10px 0;
            color: #ffff00;
            text-shadow: 1px 1px 0px #000000;
        }
        
        @media (max-width: 480px) {
            #gameContainer {
                border: 2px solid #ffffff;
            }
            .title {
                font-size: 16px;
            }
            .instruction {
                font-size: 8px;
            }
            .gameOverTitle {
                font-size: 20px;
            }
            .score {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="ui">
            <div>ìƒì¡´ ì‹œê°„: <span id="timer">0</span>ì´ˆ</div>
        </div>
        
        <div id="startScreen">
            <div class="title">ğŸ›¸ UFO ìš´ì„ í”¼í•˜ê¸° ğŸ›¸</div>
            <div class="instruction">PC: ì¢Œìš° í™”ì‚´í‘œ í‚¤ë¡œ ì´ë™, ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ë¯¸ì‚¬ì¼ ë°œì‚¬</div>
            <div class="instruction">ëª¨ë°”ì¼: ì¢Œìš° í„°ì¹˜ë¡œ ì´ë™, íƒ­ìœ¼ë¡œ ë¯¸ì‚¬ì¼ ë°œì‚¬</div>
            <div class="instruction">ì•„ë¬´ í‚¤ë‚˜ í„°ì¹˜ë¡œ ê²Œì„ ì‹œì‘!</div>
        </div>
        
        <div id="gameOverScreen">
            <div class="gameOverTitle">GAME OVER</div>
            <div class="score">ìƒì¡´ ì‹œê°„: <span id="finalScore">0</span>ì´ˆ</div>
            <div class="instruction">ì•„ë¬´ í‚¤ë‚˜ í„°ì¹˜ë¡œ ì¬ì‹œì‘</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const timerDisplay = document.getElementById('timer');
        const finalScoreDisplay = document.getElementById('finalScore');

        // ê²Œì„ ìƒíƒœ
        let gameState = 'start'; // 'start', 'playing', 'gameOver'
        let gameTime = 0;
        let lastTime = 0;

        // UFO ê°ì²´
        const ufo = {
            x: canvas.width / 2 - 15,
            y: canvas.height - 80,
            width: 30,
            height: 15,
            speed: 5
        };

        // ìš´ì„ ë°°ì—´
        let meteors = [];
        
        // ë¯¸ì‚¬ì¼ ë°°ì—´
        let missiles = [];

        // UFO ë„íŠ¸ë§µ (ë°˜ì›í˜•)
        const ufoPixelMap = [
            [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
            [0,1,2,3,3,3,3,3,3,3,3,3,3,2,1,0],
            [1,2,3,4,4,4,4,4,4,4,4,4,4,3,2,1],
            [1,2,3,4,5,5,5,5,5,5,5,5,4,3,2,1],
            [1,2,3,4,5,6,6,6,6,6,6,5,4,3,2,1],
            [1,2,3,4,5,6,7,7,7,7,6,5,4,3,2,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];

        // UFO ìƒ‰ìƒ íŒ”ë ˆíŠ¸
        const ufoColors = {
            0: 'transparent',
            1: '#333333',
            2: '#555555',
            3: '#777777',
            4: '#999999',
            5: '#bbbbbb',
            6: '#dddddd',
            7: '#ffffff'
        };

        // ìš´ì„ ë„íŠ¸ë§µ
        const meteorPixelMap = [
            [0,0,1,1,1,0,0],
            [0,1,2,2,2,1,0],
            [1,2,3,2,3,2,1],
            [1,2,2,3,2,2,1],
            [1,2,3,2,3,2,1],
            [0,1,2,2,2,1,0],
            [0,0,1,1,1,0,0]
        ];

        // ìš´ì„ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
        const meteorColors = {
            0: 'transparent',
            1: '#660000',
            2: '#990000',
            3: '#ff0000'
        };

        // ë¯¸ì‚¬ì¼ ë„íŠ¸ë§µ
        const missilePixelMap = [
            [0,1,0],
            [1,2,1],
            [1,3,1],
            [1,3,1],
            [0,2,0]
        ];

        // ë¯¸ì‚¬ì¼ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
        const missileColors = {
            0: 'transparent',
            1: '#0066ff',
            2: '#00aaff',
            3: '#ffffff'
        };

        // ë³„ ë°°ê²½
        const stars = [];
        for (let i = 0; i < 100; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                brightness: Math.random()
            });
        }

        // í”½ì…€ ë§µìœ¼ë¡œ ìŠ¤í”„ë¼ì´íŠ¸ ê·¸ë¦¬ê¸°
        function drawPixelSprite(x, y, pixelMap, colors, scale = 2) {
            for (let row = 0; row < pixelMap.length; row++) {
                for (let col = 0; col < pixelMap[row].length; col++) {
                    const colorKey = pixelMap[row][col];
                    const color = colors[colorKey];
                    
                    if (color !== 'transparent') {
                        ctx.fillStyle = color;
                        ctx.fillRect(
                            x + col * scale,
                            y + row * scale,
                            scale,
                            scale
                        );
                    }
                }
            }
        }

        // ë³„ ê·¸ë¦¬ê¸°
        function drawStars() {
            ctx.fillStyle = 'white';
            stars.forEach(star => {
                ctx.globalAlpha = star.brightness;
                ctx.fillRect(star.x, star.y, 1, 1);
            });
            ctx.globalAlpha = 1;
        }

        // UFO ê·¸ë¦¬ê¸°
        function drawUFO() {
            drawPixelSprite(ufo.x, ufo.y, ufoPixelMap, ufoColors, 2);
            
            // UFO í•˜ë‹¨ ë¹› íš¨ê³¼
            ctx.fillStyle = 'rgba(0, 255, 255, 0.3)';
            ctx.fillRect(ufo.x + 5, ufo.y + 16, 20, 3);
        }

        // ìš´ì„ ê·¸ë¦¬ê¸°
        function drawMeteors() {
            meteors.forEach(meteor => {
                drawPixelSprite(meteor.x, meteor.y, meteorPixelMap, meteorColors, 2);
                
                // ìš´ì„ ê¼¬ë¦¬ íš¨ê³¼
                ctx.fillStyle = 'rgba(255, 100, 0, 0.3)';
                ctx.fillRect(meteor.x + 6, meteor.y - 10, 2, 10);
            });
        }

        // ë¯¸ì‚¬ì¼ ê·¸ë¦¬ê¸°
        function drawMissiles() {
            missiles.forEach(missile => {
                drawPixelSprite(missile.x, missile.y, missilePixelMap, missileColors, 1);
                
                // ë¯¸ì‚¬ì¼ ê¸€ë¡œìš° íš¨ê³¼
                ctx.fillStyle = 'rgba(0, 170, 255, 0.5)';
                ctx.fillRect(missile.x + 1, missile.y - 3, 1, 3);
            });
        }

        // ìš´ì„ ìƒì„±
        function createMeteor() {
            meteors.push({
                x: Math.random() * (canvas.width - 14),
                y: -14,
                speed: 2 + Math.random() * 3
            });
        }

        // ë¯¸ì‚¬ì¼ ìƒì„±
        function createMissile() {
            missiles.push({
                x: ufo.x + 13, // UFO ì¤‘ì•™ì—ì„œ ë°œì‚¬
                y: ufo.y - 5,
                speed: 8
            });
        }

        // ì¶©ëŒ ê²€ì‚¬
        function checkCollision(obj1, obj2, obj1Width = 30, obj1Height = 15, obj2Width = 14, obj2Height = 14) {
            return obj1.x < obj2.x + obj2Width &&
                   obj1.x + obj1Width > obj2.x &&
                   obj1.y < obj2.y + obj2Height &&
                   obj1.y + obj1Height > obj2.y;
        }

        // ë¯¸ì‚¬ì¼ê³¼ ìš´ì„ ì¶©ëŒ ê²€ì‚¬
        function checkMissileCollision(missile, meteor) {
            return missile.x < meteor.x + 14 &&
                   missile.x + 3 > meteor.x &&
                   missile.y < meteor.y + 14 &&
                   missile.y + 5 > meteor.y;
        }

        // í­ë°œ íš¨ê³¼ (ê°„ë‹¨í•œ íŒŒí‹°í´)
        let explosions = [];
        
        function createExplosion(x, y) {
            for (let i = 0; i < 8; i++) {
                explosions.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 6,
                    vy: (Math.random() - 0.5) * 6,
                    life: 20,
                    maxLife: 20
                });
            }
        }

        function updateExplosions() {
            explosions.forEach((particle, index) => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life--;
                
                if (particle.life <= 0) {
                    explosions.splice(index, 1);
                }
            });
        }

        function drawExplosions() {
            explosions.forEach(particle => {
                const alpha = particle.life / particle.maxLife;
                ctx.fillStyle = `rgba(255, 255, 0, ${alpha})`;
                ctx.fillRect(particle.x, particle.y, 2, 2);
                ctx.fillStyle = `rgba(255, 100, 0, ${alpha * 0.7})`;
                ctx.fillRect(particle.x - 1, particle.y - 1, 4, 4);
            });
        }

        // ê²Œì„ ì—…ë°ì´íŠ¸
        function update(currentTime) {
            if (gameState !== 'playing') return;

            const deltaTime = currentTime - lastTime;
            
            // ê²Œì„ ì‹œê°„ ì—…ë°ì´íŠ¸
            gameTime += deltaTime;
            const seconds = Math.floor(gameTime / 1000);
            timerDisplay.textContent = seconds;

            // ìš´ì„ ìƒì„± (ë‚œì´ë„ ì¦ê°€)
            const meteorSpawnRate = Math.max(0.005, 0.02 - seconds * 0.001);
            if (Math.random() < meteorSpawnRate) {
                createMeteor();
            }

            // ìš´ì„ ì´ë™
            meteors.forEach((meteor, index) => {
                meteor.y += meteor.speed;
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ìš´ì„ ì œê±°
                if (meteor.y > canvas.height) {
                    meteors.splice(index, 1);
                }
                
                // UFOì™€ ìš´ì„ ì¶©ëŒ ê²€ì‚¬
                if (checkCollision(ufo, meteor)) {
                    gameState = 'gameOver';
                    const finalSeconds = Math.floor(gameTime / 1000);
                    finalScoreDisplay.textContent = finalSeconds;
                    gameOverScreen.style.display = 'flex';
                }
            });

            // ë¯¸ì‚¬ì¼ ì´ë™
            missiles.forEach((missile, missileIndex) => {
                missile.y -= missile.speed;
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ë¯¸ì‚¬ì¼ ì œê±°
                if (missile.y < -10) {
                    missiles.splice(missileIndex, 1);
                    return;
                }
                
                // ë¯¸ì‚¬ì¼ê³¼ ìš´ì„ ì¶©ëŒ ê²€ì‚¬
                meteors.forEach((meteor, meteorIndex) => {
                    if (checkMissileCollision(missile, meteor)) {
                        // ë¯¸ì‚¬ì¼ê³¼ ìš´ì„ ëª¨ë‘ ì œê±°
                        missiles.splice(missileIndex, 1);
                        meteors.splice(meteorIndex, 1);
                        
                        // í­ë°œ íš¨ê³¼ (ê°„ë‹¨í•œ íŒŒí‹°í´)
                        createExplosion(meteor.x + 7, meteor.y + 7);
                    }
                });
            });

            // í­ë°œ íŒŒí‹°í´ ì—…ë°ì´íŠ¸
            updateExplosions();
            
            lastTime = currentTime;
        }

        // ê²Œì„ ë Œë”ë§
        function render() {
            // í™”ë©´ í´ë¦¬ì–´
            ctx.fillStyle = 'rgba(0, 17, 34, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ë³„ ê·¸ë¦¬ê¸°
            drawStars();

            if (gameState === 'playing') {
                // UFO ê·¸ë¦¬ê¸°
                drawUFO();
                
                // ìš´ì„ ê·¸ë¦¬ê¸°
                drawMeteors();
                
                // ë¯¸ì‚¬ì¼ ê·¸ë¦¬ê¸°
                drawMissiles();
                
                // í­ë°œ íš¨ê³¼ ê·¸ë¦¬ê¸°
                drawExplosions();
            }
        }

        // ê²Œì„ ë£¨í”„
        function gameLoop(currentTime) {
            update(currentTime);
            render();
            requestAnimationFrame(gameLoop);
        }

        // ê²Œì„ ì‹œì‘
        function startGame() {
            gameState = 'playing';
            gameTime = 0;
            lastTime = performance.now();
            meteors = [];
            missiles = [];
            explosions = [];
            ufo.x = canvas.width / 2 - 15;
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            // íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            timerDisplay.textContent = '0';
        }

        // ê²Œì„ ì¬ì‹œì‘
        function restartGame() {
            startGame();
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            
            if (e.code === 'Space') {
                e.preventDefault();
                if (gameState === 'start') {
                    startGame();
                } else if (gameState === 'gameOver') {
                    restartGame();
                } else if (gameState === 'playing') {
                    createMissile();
                }
            }
            
            // ë‹¤ë¥¸ í‚¤ë¡œë„ ê²Œì„ ì‹œì‘/ì¬ì‹œì‘ ê°€ëŠ¥
            if (gameState === 'start' || gameState === 'gameOver') {
                if (e.code !== 'Space') {
                    if (gameState === 'start') {
                        startGame();
                    } else {
                        restartGame();
                    }
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        // UFO ì´ë™ (í‚¤ë³´ë“œ)
        function handleKeyboardInput() {
            if (gameState !== 'playing') return;
            
            if (keys['ArrowLeft'] && ufo.x > 0) {
                ufo.x -= ufo.speed;
            }
            if (keys['ArrowRight'] && ufo.x < canvas.width - 30) {
                ufo.x += ufo.speed;
            }
        }

        // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼)
        let touchStartX = 0;
        let lastTouchTime = 0;
        
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const currentTime = Date.now();
            touchStartX = e.touches[0].clientX;
            
            if (gameState === 'start') {
                startGame();
            } else if (gameState === 'gameOver') {
                restartGame();
            } else if (gameState === 'playing') {
                // ë”ë¸”íƒ­ ë°©ì§€ë¥¼ ìœ„í•œ ì‹œê°„ ì²´í¬
                if (currentTime - lastTouchTime > 200) {
                    createMissile();
                    lastTouchTime = currentTime;
                }
            }
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (gameState !== 'playing') return;
            
            const touchCurrentX = e.touches[0].clientX;
            const deltaX = touchCurrentX - touchStartX;
            
            ufo.x += deltaX * 0.5;
            ufo.x = Math.max(0, Math.min(canvas.width - 30, ufo.x));
            
            touchStartX = touchCurrentX;
        });

        // í´ë¦­ ì´ë²¤íŠ¸ (PCì—ì„œ í„°ì¹˜ ëŒ€ì‹ )
        canvas.addEventListener('click', (e) => {
            if (gameState === 'start') {
                startGame();
            } else if (gameState === 'gameOver') {
                restartGame();
            } else if (gameState === 'playing') {
                const rect = canvas.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                
                // ë¯¸ì‚¬ì¼ ë°œì‚¬
                createMissile();
                
                // UFO ì´ë™ (í´ë¦­ ìœ„ì¹˜ì— ë”°ë¼)
                if (clickX < canvas.width / 2) {
                    ufo.x = Math.max(0, ufo.x - 30);
                } else {
                    ufo.x = Math.min(canvas.width - 30, ufo.x + 30);
                }
            }
        });

        // ë©”ì¸ ê²Œì„ ë£¨í”„ ì‹œì‘
        function mainLoop(currentTime) {
            handleKeyboardInput();
            update(currentTime);
            render();
            requestAnimationFrame(mainLoop);
        }

        // ì´ˆê¸°í™” ë° ê²Œì„ ì‹œì‘
        lastTime = performance.now();
        mainLoop(lastTime);
    </script>
</body>
</html>
